import{d as F,g as x,o as Q,a as ue,k as de,l as h,e as p,f as k,n as S,q as D,m as b,t as z,j as M,s as a,p as c,a3 as q,a4 as me,W as pe,u as fe,I as ge,i as ve,C as _e,a5 as J,r as v,c as G,b as he,h as ye,F as R,D as P,G as Ce,a1 as be,a6 as W,$ as ke,E as Y,a2 as we,a0 as Oe}from"./index-de12ee84.js";import{_ as X,d as $e,y as Ie,z as Se,A as Me,C as Pe,e as Ve,c as je,D as Ne,E as Ee,G as Fe,B as Ue,w as Te,M as V,n as Le,q as ze,v as Be,H as xe,l as He}from"./index-d4bbfe67.js";const Ae=F({name:"Message",components:{AIconHover:$e,IconInfoCircleFill:Ie,IconCheckCircleFill:Se,IconExclamationCircleFill:Me,IconCloseCircleFill:Pe,IconClose:Ve,IconLoading:je},props:{type:{type:String,default:"info"},closable:{type:Boolean,default:!1},showIcon:{type:Boolean,default:!0},duration:{type:Number,default:3e3},resetOnUpdate:{type:Boolean,default:!1},resetOnHover:{type:Boolean,default:!1}},emits:["close"],setup(e,{emit:t}){const s=x("message");let o=0;const u=()=>{t("close")},n=()=>{e.duration>0&&(o=window.setTimeout(u,e.duration))},l=()=>{o&&(window.clearTimeout(o),o=0)};return Q(()=>{n()}),ue(()=>{e.resetOnUpdate&&(l(),n())}),de(()=>{l()}),{handleMouseEnter:()=>{e.resetOnHover&&l()},handleMouseLeave:()=>{e.resetOnHover&&n()},prefixCls:s,handleClose:u}}});function De(e,t,s,o,u,n){const l=h("icon-info-circle-fill"),i=h("icon-check-circle-fill"),f=h("icon-exclamation-circle-fill"),O=h("icon-close-circle-fill"),U=h("icon-loading"),T=h("icon-close"),L=h("a-icon-hover");return p(),k("li",{role:"alert",class:S([e.prefixCls,`${e.prefixCls}-${e.type}`,{[`${e.prefixCls}-closable`]:e.closable}]),onMouseenter:t[1]||(t[1]=(..._)=>e.handleMouseEnter&&e.handleMouseEnter(..._)),onMouseleave:t[2]||(t[2]=(..._)=>e.handleMouseLeave&&e.handleMouseLeave(..._))},[e.showIcon&&!(e.type==="normal"&&!e.$slots.icon)?(p(),k("span",{key:0,class:S(`${e.prefixCls}-icon`)},[D(e.$slots,"icon",{},()=>[e.type==="info"?(p(),b(l,{key:0})):e.type==="success"?(p(),b(i,{key:1})):e.type==="warning"?(p(),b(f,{key:2})):e.type==="error"?(p(),b(O,{key:3})):e.type==="loading"?(p(),b(U,{key:4})):z("v-if",!0)])],2)):z("v-if",!0),M("span",{class:S(`${e.prefixCls}-content`)},[D(e.$slots,"default")],2),e.closable?(p(),k("span",{key:1,class:S(`${e.prefixCls}-close-btn`),onClick:t[0]||(t[0]=(..._)=>e.handleClose&&e.handleClose(..._))},[a(L,null,{default:c(()=>[a(T)]),_:1})],2)):z("v-if",!0)],34)}var qe=X(Ae,[["render",De]]);function Je(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!pe(e)}var Ge=F({name:"MessageList",props:{messages:{type:Array,default:()=>[]},position:{type:String,default:"top"}},emits:["close","afterClose"],setup(e,t){const s=x("message-list"),{zIndex:o}=Ne("message",{runOnMounted:!0});return()=>{let u;return a(me,{class:[s,`${s}-${e.position}`],name:"fade-message",tag:"ul",style:{zIndex:o.value},onAfterLeave:()=>t.emit("afterClose")},Je(u=e.messages.map(n=>{const l={default:q(n.content),icon:q(n.icon)};return a(qe,{key:n.id,type:n.type,duration:n.duration,closable:n.closable,resetOnUpdate:n.resetOnUpdate,resetOnHover:n.resetOnHover,onClose:()=>t.emit("close",n.id)},l)}))?u:{default:()=>[u]})}}}),Re=Object.defineProperty,We=Object.defineProperties,Ye=Object.getOwnPropertyDescriptors,Z=Object.getOwnPropertySymbols,Ze=Object.prototype.hasOwnProperty,Ke=Object.prototype.propertyIsEnumerable,K=(e,t,s)=>t in e?Re(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,N=(e,t)=>{for(var s in t||(t={}))Ze.call(t,s)&&K(e,s,t[s]);if(Z)for(var s of Z(t))Ke.call(t,s)&&K(e,s,t[s]);return e},ee=(e,t)=>We(e,Ye(t));class Qe{constructor(t,s){this.messageCount=0,this.add=n=>{var l;this.messageCount++;const i=(l=n.id)!=null?l:`__arco_message_${this.messageCount}`;if(this.messageIds.has(i))return this.update(i,n);const f=ge(N({id:i},n));return this.messages.value.push(f),this.messageIds.add(i),{close:()=>this.remove(i)}},this.update=(n,l)=>{for(let i=0;i<this.messages.value.length;i++)if(this.messages.value[i].id===n){const f=!ve(l.duration);Object.assign(this.messages.value[i],ee(N({},l),{id:n,resetOnUpdate:f}));break}return{close:()=>this.remove(n)}},this.remove=n=>{for(let l=0;l<this.messages.value.length;l++){const i=this.messages.value[l];if(i.id===n){_e(i.onClose)&&i.onClose(n),this.messages.value.splice(l,1),this.messageIds.delete(n);break}}},this.clear=()=>{this.messages.value.splice(0)},this.destroy=()=>{this.messages.value.length===0&&this.container&&(J(null,this.container),document.body.removeChild(this.container),this.container=null,w[this.position]=void 0)};const{position:o="top"}=t;this.container=Ee("message"),this.messageIds=new Set,this.messages=v([]),this.position=o;const u=a(Ge,{messages:this.messages.value,position:o,onClose:this.remove,onAfterClose:this.destroy});(s??E._context)&&(u.appContext=s??E._context),J(u,this.container),document.body.appendChild(this.container)}}const w={},te=[...Fe,"loading","normal"],j=te.reduce((e,t)=>(e[t]=(s,o)=>{fe(s)&&(s={content:s});const u=N({type:t},s),{position:n="top"}=u;return w[n]||(w[n]=new Qe(u,o)),w[n].add(u)},e),{});j.clear=e=>{var t;e?(t=w[e])==null||t.clear():Object.values(w).forEach(s=>s==null?void 0:s.clear())};const E=ee(N({},j),{install:e=>{const t={clear:j.clear};for(const s of te)t[s]=(o,u=e._context)=>j[s](o,u);e.config.globalProperties.$message=t},_context:null});const Xe=F({name:"IconMinusCircle",props:{size:{type:[Number,String]},strokeWidth:{type:Number,default:4},strokeLinecap:{type:String,default:"butt",validator:e=>["butt","round","square"].includes(e)},strokeLinejoin:{type:String,default:"miter",validator:e=>["arcs","bevel","miter","miter-clip","round"].includes(e)},rotate:Number,spin:Boolean},emits:{click:e=>!0},setup(e,{emit:t}){const s=x("icon"),o=G(()=>[s,`${s}-minus-circle`,{[`${s}-spin`]:e.spin}]),u=G(()=>{const l={};return e.size&&(l.fontSize=he(e.size)?`${e.size}px`:e.size),e.rotate&&(l.transform=`rotate(${e.rotate}deg)`),l});return{cls:o,innerStyle:u,onClick:l=>{t("click",l)}}}}),et=["stroke-width","stroke-linecap","stroke-linejoin"],tt=M("path",{d:"M32 24H16m26 0c0 9.941-8.059 18-18 18S6 33.941 6 24 14.059 6 24 6s18 8.059 18 18Z"},null,-1),st=[tt];function ot(e,t,s,o,u,n){return p(),k("svg",{viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",class:S(e.cls),style:ye(e.innerStyle),"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin,onClick:t[0]||(t[0]=(...l)=>e.onClick&&e.onClick(...l))},st,14,et)}var B=X(Xe,[["render",ot]]);const nt=Object.assign(B,{install:(e,t)=>{var s;const o=(s=t==null?void 0:t.iconPrefix)!=null?s:"";e.component(o+B.name,B)}}),at=M("span",null,"添加标签",-1),lt=F({__name:"Config",setup(e){const t=v([]),s=v(),o=v({timestamp:"",name:"",logPath:"",logFilename:"",tags:[{label:"",slug:""}]}),u=v({name:[{required:!0,message:"请输入日志名称"}],logPath:[{required:!0,message:"请输入日志目录"}],logFilename:[{required:!0,message:"请输入日志文件名"}]}),n=v([{title:"日志名称",dataIndex:"name"},{title:"日志目录",dataIndex:"logPath"},{title:"日志文件名",dataIndex:"logFilename"},{title:"业务标签",dataIndex:"tags",slotName:"tags"},{title:"操作",slotName:"action"}]),l=v([{title:"标签名称",dataIndex:"label",slotName:"label"},{title:"标签键名",dataIndex:"slug",slotName:"slug"},{title:"",slotName:"action"}]),i=v(!1),f=v("");Q(()=>{O()});async function O(){try{const d=await fetch("/api/logConfig/list"),{data:m=[]}=await d.json();t.value=m}catch(d){console.error(d)}}function U(){i.value=!0,f.value="添加日志配置",s.value.resetFields()}function T(d){i.value=!0,f.value="编辑日志配置",s.value.resetFields(),o.value=JSON.parse(JSON.stringify(d))}function L(d){V.confirm({title:"确认删除",content:`确认删除日志配置 "${d.name}" 吗？`,onOk:async()=>{try{const m=await fetch("/api/logConfig/delete",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({timestamp:d.timestamp})}),{code:g,msg:$}=await m.json();if(g)throw new Error($);E.success({content:"删除成功"}),await O()}catch(m){console.error(m),V.error({title:"删除失败",content:m.msg||"删除失败"})}}})}async function _(){try{const d=o.value.timestamp?"/api/logConfig/update":"/api/logConfig/add",m=await fetch(d,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o.value)}),{code:g,msg:$}=await m.json();if(g)throw new Error($);E.success({content:o.value.timestamp?"修改成功":"添加成功"}),s.value.resetFields(),await O()}catch(d){console.error(d),V.error({title:o.value.timestamp?"修改失败":"添加失败",content:d.msg||typeof d=="string"?d:JSON.stringify(d)})}}async function se(){await s.value.validate(),await _()}function oe(){i.value=!1,s.value.resetFields()}function ne(){o.value.tags.push({label:"",slug:""})}function ae(d){o.value.tags.splice(d,1)}function le(d){o.value.tags=d}return(d,m)=>{const g=Ue,$=He,H=ke,A=Te,y=Le,I=ze,ie=Be,re=V;return p(),k(R,null,[M("div",null,[a(g,{type:"primary",onClick:U},{default:c(()=>[P("新建配置")]),_:1})]),a(A,{data:t.value,columns:n.value,pagination:!1,stripe:"",style:{"margin-top":"24px"}},{tags:c(({record:r})=>[a(H,null,{default:c(()=>[(p(!0),k(R,null,Ce(r.tags||[],(C,ce)=>(p(),b($,{key:ce},{default:c(()=>[P(Y(C.label)+": "+Y(C.slug),1)]),_:2},1024))),128))]),_:2},1024)]),action:c(({record:r})=>[a(H,null,{default:c(()=>[a(g,{type:"text",onClick:()=>T(r)},{default:c(()=>[P("编辑")]),_:2},1032,["onClick"]),a(g,{type:"text",status:"danger",onClick:()=>L(r)},{default:c(()=>[P(" 删除 ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:1},8,["data","columns"]),a(re,{visible:i.value,"onUpdate:visible":m[4]||(m[4]=r=>i.value=r),title:f.value,width:"680px",onCancel:oe,onOk:se},{default:c(()=>[a(ie,{ref_key:"formRef",ref:s,model:o.value,rules:u.value,onSubmit:_},{default:c(()=>[be(a(I,{field:"timestamp",label:"时间戳"},{default:c(()=>[a(y,{modelValue:o.value.timestamp,"onUpdate:modelValue":m[0]||(m[0]=r=>o.value.timestamp=r)},null,8,["modelValue"])]),_:1},512),[[we,!1]]),a(I,{field:"name",label:"日志名称"},{default:c(()=>[a(y,{modelValue:o.value.name,"onUpdate:modelValue":m[1]||(m[1]=r=>o.value.name=r)},null,8,["modelValue"])]),_:1}),a(I,{field:"logPath",label:"日志目录"},{default:c(()=>[a(y,{modelValue:o.value.logPath,"onUpdate:modelValue":m[2]||(m[2]=r=>o.value.logPath=r)},null,8,["modelValue"])]),_:1}),a(I,{field:"logFilename",label:"日志文件名"},{default:c(()=>[a(y,{modelValue:o.value.logFilename,"onUpdate:modelValue":m[3]||(m[3]=r=>o.value.logFilename=r)},null,8,["modelValue"])]),_:1}),a(I,{field:"tags",label:"业务标签"},{default:c(()=>[M("div",null,[a(A,{data:o.value.tags,columns:l.value,pagination:!1,draggable:{type:"handle",width:40},style:{width:"100%"},onChange:le},{label:c(({record:r})=>[a(y,{modelValue:r.label,"onUpdate:modelValue":C=>r.label=C,placeholder:"标签名称"},null,8,["modelValue","onUpdate:modelValue"])]),slug:c(({record:r})=>[a(y,{modelValue:r.slug,"onUpdate:modelValue":C=>r.slug=C,placeholder:"标签key"},null,8,["modelValue","onUpdate:modelValue"])]),action:c(({rowIndex:r})=>[a(g,{size:"small",type:"text",status:"danger",onClick:()=>ae(r)},{icon:c(()=>[a(W(nt))]),_:2},1032,["onClick"])]),_:1},8,["data","columns"]),a(g,{type:"outline",style:{"margin-top":"12px"},onClick:ne},{icon:c(()=>[a(W(xe))]),default:c(()=>[at]),_:1})])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["visible","title"])],64)}}}),ct=Oe(lt,[["__file","/Users/apisitlee/projects/winston-dashboard-vue/web/src/views/Config.vue"]]);export{ct as default};
